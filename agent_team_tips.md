예상치 못한 종료 후 에이전트 팀 복구 가이드

       개요

       에이전트 팀이 충돌, 네트워크 문제 등으로 예상치 못하게 종료된 경우,
        Claude Code는 여러 복구 메커니즘을 제공합니다. 다음은 종합적인
       복구 전략입니다.

       ---
       1. 세션 재개 (Session Resume) 메커니즘

       기본 세션 재개 명령어

       Claude Code는 중단된 세션을 복구할 수 있습니다:

       # 가장 최근 세션 계속하기
       claude --continue
       # 또는
       claude -c

       # 특정 세션 ID 또는 이름으로 재개
       claude --resume <session-name-or-id>
       # 또는
       claude -r "<session-name-or-id>"

       # 대화형 선택기를 열어 세션 선택
       claude --resume

       세션 재개의 동작:
       - 같은 세션 ID를 사용하여 이전 대화 기록이 완전히 복구됩니다
       - 새로운 메시지는 기존 대화에 추가됩니다
       - 세션 범위 권한은 재복구되지 않으므로 다시 승인이 필요할 수
       있습니다

       ---
       2. 에이전트 팀의 세션 재개 제한사항

       중요한 제한: 에이전트 팀에는 현재 주요 제약이 있습니다.

       ⚠️   주의사항 (공식 문서)
       • In-process 팀메이트의 경우 `/resume` 및 `/rewind`가 팀메이트를
       복구하지 않습니다
       • 세션 재개 후 리드(lead)가 더 이상 존재하지 않는 팀메이트에게
       메시지를 보내려고 시도할 수 있습니다
       • 이 경우 리드에게 새 팀메이트를 생성하도록 지시하세요

       복구 워크플로우:
       상황: 에이전트 팀이 충돌
       ↓
       리드 세션 재개 (claude --resume)
       ↓
       기존 팀메이트 재연결 불가능
       ↓
       새 팀메이트 수동으로 생성 요청
       ↓
       작업 계속하기

       ---
       3. 공유 작업 목록 (Task List) 복구

       작업 목록 보존

       좋은 소식: 작업 목록은 로컬에 저장되며 충돌 후에도 유지됩니다.

       저장 위치:
       - 팀 구성: ~/.claude/teams/{team-name}/config.json
       - 작업 목록: ~/.claude/tasks/{team-name}/

       작업 목록 기능:
       • 모든 팀원이 공유 작업 목록을 볼 수 있습니다
       • 작업은 3가지 상태를 가집니다: pending(대기), in progress(진행중),
        completed(완료)
       • 작업 간 의존성이 자동으로 관리됩니다
       • 파일 잠금을 사용하여 여러 팀메이트의 동시 작업 청구를 방지합니다

       충돌 후 작업 목록 사용:
       # 작업 목록 보기
       Ctrl+T  # 터미널에서 토글

       # 명령어로 작업 관리
       # "show me all tasks" - 모든 작업 표시
       # "clear all tasks" - 모든 작업 제거

       작업 목록 ID 지정:
       # 특정 명명된 디렉토리의 작업 목록 사용
       export CLAUDE_CODE_TASK_LIST_ID=my-project
       claude --resume

       ---
       4. 체크포인트 (Checkpoint) 메커니즘

       자동 추적

       Claude Code는 모든 파일 편집을 자동으로 추적합니다:

       • 모든 사용자 프롬프트가 새로운 체크포인트를 생성합니다
       • 체크포인트는 세션 간에 지속됩니다 (재개된 대화에서도 접근 가능)
       • 체크포인트는 세션과 함께 30일 후 자동 정리됩니다

       복구 옵션 (Esc + Esc 또는 /rewind)

       Esc + Esc를 눌러서 되감기 메뉴를 열면 다음 옵션이 있습니다:

       1. "Restore code and conversation"
          → 코드와 대화 모두를 특정 지점으로 복원

       2. "Restore conversation"
          → 현재 코드는 유지하고 대화만 복원

       3. "Restore code"
          → 파일 변경사항만 취소하고 대화는 유지

       4. "Summarize from here"
          → 이 지점 이후를 요약하여 컨텍스트 공간 확보

       코드 변경 제한

       중요: 체크포인트는 다음을 추적하지 않습니다:
       - Bash 명령어로 인한 파일 수정 (rm, mv, cp 등)
       - 세션 외부에서의 수동 변경사항
       - 다른 동시 세션의 편집

       ---
       5. 상태 지속성 (State Persistence)

       세션 데이터 저장

       Claude Code는 로컬에 다음을 저장합니다:

       ~/.claude/
         ├── projects/
         │   └── <project-path>/
         │       ├── MEMORY.md (프로젝트 메모리)
         │       └── sessions/
         │           └── <session-files>
         ├── teams/
         │   └── <team-name>/
         │       └── config.json (팀 구성, 팀원 정보)
         ├── tasks/
         │   └── <team-name>/ (공유 작업 목록)
         └── checkpoints/
             └── <checkpoint-data>

       컨텍스트 윈도우 압축

       세션 재개 시, 다음이 자동으로 처리됩니다:

       • 오래된 도구 출력부터 정리됩니다
       • 필요시 대화 내용이 요약됩니다
       • 초기 요청과 핵심 코드 스니펫은 보존됩니다
       • CLAUDE.md의 persistent rules는 항상 포함됩니다

       ---
       6. 최상의 복구 실전 가이드

       Step 1: 세션 재개

       # 가장 최근 세션으로 돌아가기
       claude --continue

       # 또는 특정 세션 선택
       claude --resume

       Step 2: 상태 확인

       # 대화 기록 확인
       /context          # 컨텍스트 사용량 시각화

       # 비용 확인
       /cost             # 토큰 사용량 통계

       # 작업 목록 확인
       Ctrl+T            # 진행 상황 확인

       Step 3: 에이전트 팀 복구 (충돌한 경우)

       리드 세션이 재개되었으면:

       "우리가 충돌한 팀메이트들을 새로 생성해서 이전 작업을 계속해 줄 수
       있을까?"

       또는

       "X, Y, Z 팀메이트를 다시 생성하고 현재 상태를 보여줘"

       Step 4: 작업 재개

       # 팀메이트에게 직접 메시지 (in-process 모드)
       Shift+Up/Down     # 팀메이트 선택
       <type message>    # 메시지 입력

       # 또는 리드에게 지시
       "다음 작업을 진행해 줘: ..."

       ---
       7. 포크 (Fork) vs 재개 (Resume)

       충돌 후 다른 접근을 시도하고 싶다면:

       # 기존 세션은 유지하고 새 분기 생성
       claude --continue --fork-session

       # 이점:
       # • 원본 세션은 그대로 유지
       # • 여기까지의 대화 기록은 복사됨
       # • 새로운 세션 ID 생성

       ---
       8. 세션 이름 지정 및 찾기

       더 쉬운 복구를 위해:

       # 세션 이름 지정
       /rename my-agent-team-project

       # 나중에 이름으로 복구
       claude --resume my-agent-team-project

       ---
       9. 주요 제한사항 정리

       ┌─────────────────────┬───────────┬────────────────────────────────
       ───┐
       │        항목         │   상태    │               설명
          │
       ├─────────────────────┼───────────┼────────────────────────────────
       ───┤
       │ 세션 대화 재개      │ ✅ 지원   │ 대화 기록은 모두 복원됨
          │
       ├─────────────────────┼───────────┼────────────────────────────────
       ───┤
       │ 체크포인트          │ ✅ 지원   │ 파일 편집은 재개 후에도 복원
       가능 │
       ├─────────────────────┼───────────┼────────────────────────────────
       ───┤
       │ 작업 목록           │ ✅ 지원   │ 공유 작업 목록은 지속됨
          │
       ├─────────────────────┼───────────┼────────────────────────────────
       ───┤
       │ In-process 팀메이트 │ ❌ 미지원 │ /resume 후 팀메이트 복구 불가능
          │
       ├─────────────────────┼───────────┼────────────────────────────────
       ───┤
       │ Split-pane 팀메이트 │ ⚠️  제한적 │ Tmux 세션은 수동으로 정리 필요
          │
       ├─────────────────────┼───────────┼────────────────────────────────
       ───┤
       │ 팀메이트 메시징     │ ⚠️  제한적 │ 복구된 팀메이트가 없을 수 있음
          │
       ├─────────────────────┼───────────┼────────────────────────────────
       ───┤
       │ Bash 명령 변경      │ ❌ 미지원 │ 체크포인트가 추적하지 않음
          │
       └─────────────────────┴───────────┴────────────────────────────────
       ───┘






       ---
       10. 고급 복구 시나리오

       시나리오 A: Split-pane 모드에서 tmux 세션 남음

       # 활성 세션 확인
       tmux ls

       # 팀에 의한 세션 정리
       tmux kill-session -t <session-name>

       # 세션 재개
       claude --resume

       시나리오 B: 작업 목록이 불일치

       "어떤 작업이 완료되었는지 확인해 줄 수 있을까?"

       → 리드가 팀메이트의 실제 진행 상황과 작업 목록을 비교하고
          필요시 수동으로 작업 상태 업데이트

       시나리오 C: 팀메이트가 오류 후 멈춤

       # in-process 모드에서
       Shift+Up/Down     # 멈춘 팀메이트 선택
       "발생한 오류를 고쳐서 계속 진행해 줄 수 있을까?"

       # 또는 새 팀메이트 생성
       "auth-reviewer 팀메이트를 새로 생성해서
        인증 모듈 검토를 계속해 줄 수 있을까?"

       ---
       11. 예방 전략

       권장 사항

       1. 정기적인 커밋
          git add . && git commit -m "Checkpoint: [description]"

       2. CLAUDE.md에 프로젝트 정보 저장
          - 팀 구조와 역할
          - 진행 중인 작업 설명
          - 중요 결정사항

       3. 작업 목록에 명확한 설명 작성
          - 각 작업의 목표를 구체적으로
          - 의존성 명시

       4. 정기적인 팀 체크인
          "모든 팀메이트의 현재 상태를 정리해 줄 수 있을까?"

       환경 변수 설정

       # 명명된 작업 목록 사용 (어떤 세션에서든 접근 가능)
       export CLAUDE_CODE_TASK_LIST_ID=my-project-name

       # 세션 이름으로 쉽게 재개
       claude --resume my-project-name

       ---
       요약: 복구 흐름도

       에이전트 팀 충돌/종료
              ↓
          claude --continue
          또는 claude --resume
              ↓
          세션 대화 기록 복구됨 ✅
          작업 목록 복구됨 ✅
              ↓
          In-process 팀메이트는?
          ↙                     ↘
        복구 불가능            새로 생성 필요
          ↓                        ↓
        "Show me all tasks"    "Create teammates for..."
          ↓                        ↓
        진행 상황 확인         작업 계속 진행

       ---
       참고자료

       - 공식 에이전트 팀 문서:
       https://code.claude.com/docs/en/agent-teams.md
       - 세션 관리: https://code.claude.com/docs/en/how-claude-code-works.
       md#work-with-sessions
       - 체크포인팅: https://code.claude.com/docs/en/checkpointing.md
       - CLI 참조: https://code.claude.com/docs/en/cli-reference.md
       - 대화형 모드:
       https://code.claude.com/docs/en/interactive-mode.md#task-list

       이 가이드를 통해 대부분의 에이전트 팀 충돌 상황에서 작업을
       성공적으로 복구할 수 있습니다. 가장 중요한 것은 세션 재개 명령어로
       대화 기록과 작업 목록이 보존된다는 점이며, 팀메이트는 필요시 새로
       생성할 수 있다는 것입니다.

  ⎿  Done (7 tool uses · 41.0k tokens · 49s)

                                              10:32 PM claude-opus-4-6
● 예기치 못한 종료 후 Agent Team 복구 방법

  ---
  핵심 요약
  ┌────────────────────────────┬───────────────────────────────┐
  │            항목            │        복구 가능 여부         │
  ├────────────────────────────┼───────────────────────────────┤
  │ 세션 대화 기록             │ ✅ 복원됨                     │
  ├────────────────────────────┼───────────────────────────────┤
  │ 체크포인트 (파일 편집)     │ ✅ 복원 가능                  │
  ├────────────────────────────┼───────────────────────────────┤
  │ 공유 작업 목록 (Task List) │ ✅ 지속됨                     │
  ├────────────────────────────┼───────────────────────────────┤
  │ 팀메이트 프로세스          │ ❌ 복구 불가 — 새로 생성 필요 │
  └────────────────────────────┴───────────────────────────────┘
  ---
  Step 1: 리더 세션 재개

  # 가장 최근 세션 이어서 시작
  claude --continue

  # 또는 세션 목록에서 선택
  claude --resume

  # 이름을 지정했다면 이름으로 재개
  claude --resume my-agent-team

  대화 기록과 컨텍스트가 복원됩니다.

  ---
  Step 2: 작업 목록 확인

  세션 재개 후 Ctrl+T 또는 자연어로 작업 목록을 확인합니다:

  "현재 작업 목록을 보여줘"

  작업 목록은 로컬에 저장되므로 충돌 후에도 pending/in_progress/completed
  상태가 그대로 유지됩니다.

  ---
  Step 3: 팀메이트 재생성

  In-process 팀메이트는 resume으로 복구되지 않습니다. 리더에게 새로 만들도록
  지시해야 합니다:

  "이전에 충돌이 발생했어. 작업 목록을 확인하고,
  아직 완료되지 않은 작업을 처리할 팀메이트들을 다시 생성해줘"

  ---
  Step 4: 코드 상태 확인 (체크포인트)

  파일 변경사항을 되돌리거나 확인하려면:

  - Esc + Esc → 되감기(rewind) 메뉴
    - Restore code and conversation — 코드+대화 모두 복원
    - Restore code — 파일 변경만 취소
    - Restore conversation — 대화만 복원

  ---
  예방 전략 (권장)

  1. 세션에 이름 붙이기
  /rename my-agent-team
  나중에 claude --resume my-agent-team으로 쉽게 복구

  2. 정기적으로 git commit
  "현재까지 진행된 내용을 커밋해줘"
  충돌 시 git 기록으로 안전하게 복구 가능

  3. CLAUDE.md에 팀 구조 기록
  ## Agent Team 구조
  - 보안 검토자: 인증 모듈 담당
  - 성능 분석가: DB 쿼리 최적화 담당
  - 테스트 담당자: 단위 테스트 작성 담당
  재개 시 리더가 맥락을 바로 파악할 수 있습니다.

  4. 작업 목록 ID 고정
  export CLAUDE_CODE_TASK_LIST_ID=my-project
  어떤 세션에서든 같은 작업 목록에 접근 가능

  ---
  복구 흐름 요약

  프로세스 전체 종료
          ↓
    claude --continue (리더 세션 재개)
          ↓
    대화 기록 + 작업 목록 복원됨
          ↓
    팀메이트는 새로 생성 필요
          ↓
    "작업 목록 확인하고 미완료 작업 이어서 진행해줘"
          ↓
    작업 계속 진행

  가장 중요한 점: 작업 목록이 살아있기 때문에 어디까지 진행했는지 추적이
  가능하고, 팀메이트만 새로 만들면 이어서 작업할 수 있습니다.
